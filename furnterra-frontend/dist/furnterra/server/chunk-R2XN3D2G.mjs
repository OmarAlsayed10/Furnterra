import './polyfills.server.mjs';
import{a as N,b as i,c as $,d as j,e as k,f as q,g as R,h as G,i as M,j as Q,k as B,l as D}from"./chunk-KXJKBTJQ.mjs";import{D as A,i as E,z as V}from"./chunk-RRDARBPN.mjs";import{$a as o,Ba as m,Ga as y,La as _,Va as d,X as v,Xa as x,Y as g,Ya as w,Za as C,_a as T,ab as s,bb as b,cb as O,db as u,eb as I,fb as S,gb as F,hb as P,ib as p,wa as l}from"./chunk-7JXXYRXS.mjs";import{g as h}from"./chunk-X2SEQXRR.mjs";var z=["otpinput"];function H(a,t){a&1&&(o(0,"p",4),p(1,"please check your email"),s())}function J(a,t){if(a&1){let e=O();o(0,"input",11,0),u("input",function(n){let f=v(e).$index,c=I();return g(c.handleInput(n,f))}),s()}if(a&2){let e=t.$implicit;d("formControlName",e)}}var L=class a{constructor(t,e,r,n){this.router=t;this.fb=e;this.auth=r;this.alerts=n;this.otpForm=this.fb.group({d0:["",[i.required,i.pattern(/^[0-9]$/)]],d1:["",[i.required,i.pattern(/^[0-9]$/)]],d2:["",[i.required,i.pattern(/^[0-9]$/)]],d3:["",[i.required,i.pattern(/^[0-9]$/)]],d4:["",[i.required,i.pattern(/^[0-9]$/)]],d5:["",[i.required,i.pattern(/^[0-9]$/)]]});let c=this.router.getCurrentNavigation()?.extras.state;this.email=c?.email||"",this.email||(this.alerts.show("Email is missing, please enter your email","error"),this.router.navigate(["/register"]))}email="";otpForm;otpInputs;controls=["d0","d1","d2","d3","d4","d5"];focusInput(t){let e=this.otpInputs.get(t);e&&e.nativeElement.focus()}ngAfterViewInit(){this.focusInput(0)}handleInput(t,e){let n=t.target.value;n.length===1&&e<this.controls.length-1?this.focusInput(e+1):t instanceof InputEvent&&e>0&&n===""&&t.inputType==="deleteContentBackward"&&this.focusInput(e-1)}verifyOtp(){if(this.otpForm.invalid){this.alerts.show("please enter the 6 digits OTP","error");return}let t=Object.values(this.otpForm.value).join("");this.auth.verifyOtp({email:this.email,otp:t}).subscribe({next:e=>{this.auth.setToken(e.access_token),this.alerts.show("OTP verified , redirecting...","success"),setTimeout(()=>h(this,null,function*(){this.router.navigate(["/"])}),2e3)},error:e=>{let r=e?.error?.message;console.log(r),this.alerts.show(r,"error")}})}resendOtp(){this.auth.resendOtp(this.email).subscribe({next:t=>{this.alerts.show("OTP has been sent to your email","success")},error:t=>{let e=t?.error?.message;this.alerts.show(e,"error")}})}static \u0275fac=function(e){return new(e||a)(m(V),m(M),m(A),m(B))};static \u0275cmp=y({type:a,selectors:[["app-otp"]],viewQuery:function(e,r){if(e&1&&S(z,5),e&2){let n;F(n=P())&&(r.otpInputs=n)}},decls:15,vars:2,consts:[["otpinput",""],[1,"min-h-screen","flex","items-center","justify-center","p-4","text-center"],[1,"w-full","max-w-md","shadow","rounded","p-6"],[1,"font-bold","text-2xl"],[1,"text-sm","text-gray-400"],[3,"ngSubmit","formGroup"],[1,"flex","gap-2","justify-center","items-center","mb-4"],["type","text","maxlength","1",1,"text-center","border","rounded","w-8","h-8","md:w-12","md:h-12","lg:w-15","lg:h-15",3,"formControlName"],["type","submit",1,"px-5","py-1","rounded","text-white","bg-emerald-800","cursor-pointer"],[1,"text-sm","underline","mt-2","cursor-pointer",3,"click"],[1,"fixed","bottom-4","left-1/2","transform","-translate-x-1/2","z-50"],["type","text","maxlength","1",1,"text-center","border","rounded","w-8","h-8","md:w-12","md:h-12","lg:w-15","lg:h-15",3,"input","formControlName"]],template:function(e,r){e&1&&(o(0,"div",1)(1,"div",2)(2,"h2",3),p(3,"OTP Sent"),s(),_(4,H,2,0,"p",4),o(5,"form",5),u("ngSubmit",function(){return r.verifyOtp()}),o(6,"div",6),C(7,J,2,1,"input",7,w),s(),o(9,"button",8),p(10,"Verify OTP"),s()(),o(11,"p",9),u("click",function(){return r.resendOtp()}),p(12,"resend otp"),s()()(),o(13,"div",10),b(14,"app-alert"),s()),e&2&&(l(4),x(r.email?4:-1),l(),d("formGroup",r.otpForm),l(2),T(r.controls))},dependencies:[Q,k,N,$,j,G,q,R,E,D],encapsulation:2})};export{L as OTPComponent};
